# Vulnerability Patterns Integration Status

> **Purpose**: Track the integration of ClaudeSkills vulnerability patterns into each audit framework.
> **Status**: All 5 ecosystems fully integrated as of v2.0.

---

## Overview

The ClaudeSkills repository (`ClaudeSkills/plugins/building-secure-contracts/skills/`) contains 6 vulnerability scanners from Trail of Bits with detailed, actionable detection patterns. Five of the six have been fully integrated into their corresponding frameworks.

| Scanner | Target | Patterns | Framework | Integration Status |
|---------|--------|----------|-----------|-------------------|
| **Solana** | Anchor/Native | 670+ lines | Rust (`RustBaseSmartContract/`) | **COMPLETE** |
| **Cosmos** | Cosmos SDK | 741+ lines | Go (`Go-SmartContract/`) | **COMPLETE** |
| **Substrate** | Polkadot/Substrate | 792+ lines | Rust (`RustBaseSmartContract/`) | **COMPLETE** |
| **Cairo** | StarkNet | 723+ lines | Cairo (`Cairo-StarkNet/`) | **COMPLETE** |
| **Algorand** | PyTeal/TEAL | 406+ lines | Algorand (`Algorand-PyTeal/`) | **COMPLETE** |
| **TON** | FunC | 596+ lines | No framework yet | **NOT STARTED** |

---

## Integration Details Per Framework

### Rust Framework — Solana + Substrate Patterns

**Where integrated:**
- `CommandInstruction-Rust.md` — Red flags, invariants, AUDITOR'S MINDSET lenses
- `Rust-Smartcontract-workflow.md` — Phase 8 protocol-specific attacks, detection commands

**Solana patterns integrated:**

| Pattern | Severity | Where in Framework |
|---------|----------|-------------------|
| Arbitrary CPI | CRITICAL | CommandInstruction red flags, Methodology Solana checklist |
| Improper PDA Validation | CRITICAL | CommandInstruction red flags, Methodology PDA section |
| Missing Ownership Check | HIGH | CommandInstruction analysis requirements |
| Missing Signer Check | CRITICAL | CommandInstruction analysis requirements |
| Sysvar Spoofing | HIGH | Methodology known exploit patterns |

**Substrate patterns integrated:**

| Pattern | Severity | Where in Framework |
|---------|----------|-------------------|
| Arithmetic Overflow | CRITICAL | CommandInstruction red flags (primitive types wrap in release) |
| Don't Panic (DoS) | CRITICAL | CommandInstruction panic safety lens |
| Weights and Fees | CRITICAL | Methodology Substrate checklist |
| Verify First, Write Last | HIGH | Methodology semantic phase analysis |
| Unsigned Transaction Validation | HIGH | Methodology Substrate checklist |

**Tool references added:**
- Trail of Bits Solana Lints: `unchecked-cpi-program-id`, `improper-pda-validation`, `missing-ownership-check`, `missing-signer-check`
- `cargo-contract` analysis, ink! analyzer

---

### Go Framework — Cosmos C1–C6 Patterns

**Where integrated:**
- `CommandInstruction-Go.md` — AUTHORITATIVE SOURCES, CORE RULES, AUDITOR'S MINDSET (6 Go lenses), red flags
- `Go-Smart-Contract-Audit-Methodology.md` — Phase 7 patterns C1–C6, Phase 8 protocol-specific attacks, detection commands

**Cosmos patterns integrated:**

| Pattern ID | Name | Severity | Where in Framework |
|-----------|------|----------|-------------------|
| C1 | Incorrect GetSigners() | CRITICAL | Methodology Phase 7 pattern |
| C2 | Non-Determinism | CRITICAL | Methodology Phase 7 pattern, CommandInstruction red flags |
| C3 | Messages Priority | HIGH | Methodology Phase 7 pattern |
| C4 | Slow ABCI Methods | CRITICAL | Methodology Phase 7 pattern, CommandInstruction red flags |
| C5 | ABCI Methods Panic | CRITICAL | Methodology Phase 7 pattern, CommandInstruction red flags |
| C6 | Broken Bookkeeping | HIGH | Methodology Phase 7 pattern, Pro Tips |

**Tool references added:**
- CodeQL custom rules: `cosmos-non-determinism.ql`, `find-unvalidated-sdk-operations.ql`
- Detection commands for map iteration, goroutines, system time, floating point, panic-prone constructors
- `gosec`, `govulncheck`, `golangci-lint`, `go test -race`

---

### Cairo Framework — Cairo C1–C6 Patterns

**Where integrated:**
- `CommandInstruction-Cairo.md` — AUDITOR'S MINDSET (6 Cairo lenses: felt252 Thinking, Storage Layout Hunting, L1↔L2 Attack Surface, Reentrancy Awareness, Serialization Safety, Access Control Rigor), red flags, invariants
- `Cairo-Audit-Methodology.md` — Phase 8 protocol-specific attacks, Phase 9 validation/verification

**Cairo patterns integrated:**

| Pattern | Severity | Where in Framework |
|---------|----------|-------------------|
| Unchecked felt252 Arithmetic | CRITICAL | CommandInstruction Lens 1 (felt252 Thinking), Methodology Phase 3 |
| Unchecked L1 Handler from_address | CRITICAL | CommandInstruction Lens 3 (L1↔L2 Surface), Methodology Phase 5 |
| Missing Storage Layout Validation | HIGH | CommandInstruction Lens 2 (Storage Hunting), Methodology Phase 4 |
| Signature Replay | HIGH | CommandInstruction red flags, Methodology Phase 6 |
| L1→L2 Address Truncation | HIGH | Methodology L1↔L2 bridge analysis |
| Locked Funds from Failed L1→L2 | MEDIUM | Methodology bridge cancellation checks |

**Tool references added:**
- Caracal: `unchecked-felt252-arithmetic`, `unchecked-l1-handler-from`, `missing-nonce-validation`
- Starknet Foundry, Cairo-lint, Sierra analysis

---

### Algorand Framework — Algorand A1–A9 Patterns

**Where integrated:**
- `CommandInstruction-Algorand.md` — AUDITOR'S MINDSET (6 Algorand lenses: Transaction Field Hunting, Group Transaction Thinking, Inner Transaction Fee Awareness, Clear State Program Paranoia, Smart Signature Precision, Asset Opt-In Awareness), red flags, invariants
- `Algorand-Audit-Methodology.md` — Phase 3–7 attack patterns, Phase 8 protocol-specific attacks, Phase 9 validation/verification

**Algorand patterns integrated:**

| Pattern ID | Name | Severity | Where in Framework |
|-----------|------|----------|-------------------|
| A1 | Rekeying Attack | CRITICAL | CommandInstruction Lens 1, Methodology Phase 3, SCAN Transaction Fields |
| A2 | Unchecked Transaction Fee | CRITICAL | CommandInstruction Lens 5 (Smart Sig), Methodology Phase 4 |
| A3 | Closing Account (CloseRemainderTo) | CRITICAL | CommandInstruction Lens 1, Methodology Phase 3, SCAN Transaction Fields |
| A4 | Closing Asset (AssetCloseTo) | CRITICAL | CommandInstruction Lens 1, Methodology Phase 3, SCAN Transaction Fields |
| A5 | Group Size Manipulation | HIGH | CommandInstruction Lens 2 (Group Thinking), Methodology Phase 5 |
| A6 | Unprotected Update/Delete | HIGH | CommandInstruction red flags, Methodology Phase 6 |
| A7 | Asset ID Confusion | HIGH | CommandInstruction Lens 6 (Asset Opt-In), Methodology Phase 5 |
| A8 | Inner Transaction Fee Drain | HIGH | CommandInstruction Lens 3 (Inner Tx Fee), Methodology Phase 7 |
| A9 | Clear State Bypass | MEDIUM | CommandInstruction Lens 4 (Clear State Paranoia), Methodology Phase 6 |

**Tool references added:**
- Tealer: `unprotected-rekey`, `group-size-check`, `update-application-check`
- Detection grep commands for all 9 patterns

---

## What ClaudeSkills Added to Each Framework

| Aspect | Before Integration | After Integration |
|--------|-------------------|-------------------|
| **Detection Patterns** | High-level descriptions ("check for overflow") | Specific vulnerable/secure code pairs with line-level detail |
| **Tool References** | Generic tool names | Specific lint rule names ('unchecked-cpi-program-id'), grep commands |
| **Severity Context** | General severity labels | Ecosystem-specific impact (chain halt vs local DoS vs fund theft) |
| **Mitigation Examples** | Conceptual ("add a check") | Copy-paste secure code patterns with explanations |
| **Methodology Coverage** | Missing protocol-specific attack phases | Full Phase 8 (protocol-specific attacks) + Phase 9 (validation/verification) |

### Coverage Numbers

| Framework | Methodology Patterns (Before) | ClaudeSkills Added | Total Patterns |
|-----------|------------------------------|-------------------|----------------|
| Rust (Solana) | ~15 | +10 | ~25 |
| Rust (Substrate) | ~10 | +8 | ~18 |
| Go (Cosmos) | ~20 | +12 (C1–C6 + protocol attacks) | ~32 |
| Cairo (StarkNet) | ~8 | +12 (C1–C6 + protocol attacks) | ~20 |
| Algorand (PyTeal) | ~6 | +15 (A1–A9 + protocol attacks) | ~21 |

---

## Remaining Work

### TON/FunC (Not Started)
The ClaudeSkills repository contains a TON vulnerability scanner with 596+ lines of patterns for FunC smart contracts. No audit framework exists for TON yet.

**TON patterns available but not integrated:**
- Message handling vulnerabilities
- Storage fee manipulation
- TVM integer overflow (257-bit integers)
- Bounce message handling
- External message replay

**Decision:** Create a new `TON-FunC/` framework directory when demand arises.

### Cross-Chain Taxonomy (Future)
A unified vulnerability taxonomy mapping equivalent patterns across ecosystems could help auditors who work across chains:

| Universal Pattern | Solidity | Rust/Solana | Go/Cosmos | Cairo | Algorand |
|------------------|----------|-------------|-----------|-------|----------|
| Missing auth | `onlyOwner` | `is_signer` | `GetSigners()` | `get_caller_address()` | `Txn.sender()` |
| Arithmetic overflow | `unchecked{}` | primitive wrapping | `sdk.Int` edge | felt252 P-wrap | PyTeal Int |
| Reentrancy | `nonReentrant` | CPI callback | Cross-keeper | L1↔L2 re-entry | Group replay |
| State corruption | SSTORE order | `save()` order | `store.Set()` order | storage write order | `App.globalPut()` order |

---

## Source References

All patterns sourced from:
```
ClaudeSkills/plugins/building-secure-contracts/skills/
├── solana-vulnerability-scanner/resources/VULNERABILITY_PATTERNS.md    ← Integrated
├── cosmos-vulnerability-scanner/resources/VULNERABILITY_PATTERNS.md    ← Integrated
├── substrate-vulnerability-scanner/resources/VULNERABILITY_PATTERNS.md ← Integrated
├── cairo-vulnerability-scanner/resources/VULNERABILITY_PATTERNS.md     ← Integrated
├── algorand-vulnerability-scanner/resources/VULNERABILITY_PATTERNS.md  ← Integrated
└── ton-vulnerability-scanner/resources/VULNERABILITY_PATTERNS.md       ← Available
```

Each references: `building-secure-contracts/not-so-smart-contracts/<platform>/`

---

**Document Version:** 2.0
**Last Updated:** February 2026
